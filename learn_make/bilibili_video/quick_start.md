### make 和 makefile

makefile 文件主要包含了5部分内容

1. 显示规则。说明了如何生成一个或者多个目标文件。由makefile文件的创作者指出，包括要生成的文件、文件的依赖文件、生成的命令。

2. 隐式规则。由于make有自动推导的功能，所以隐式的规则可以比较粗燥的简略书写makefile文件，这是由make所支持的。

3. 变量定义。在makefile文件中要定义一系列的变量，变量一般都是字符串，这与c语言中的宏有些类似。当makefile文件执行时，其中的变量都会扩展到相应的引用位置上。

4. 文件指示。其包括三个部分，一个是在一个makefile文件中引用另一个makefile文件；另一个是指根据某些情况制定makefile文件中的有效部分；还有就是定义一个多行的命令。

5. 注释。makefile文件中只有行注释，其注释用#字符、如果要在makefile文件中使用#字符，可以用反斜杠转义。



#### Makefile中常见预定义变量

| 命令格式     | 含义                     |
| -------- | ---------------------- |
| AR       | 库文件维护程序的名称，默认是ar       |
| AS       | 汇编程序的名称，默认 as          |
| CC       | C编译器的名称，默认 cc          |
| CPP      | C预编译器的名称，默认值为 $(CC) -E |
| CXX      | c++编译器的名称，默认g++        |
| FC       | FORTRAN编译器的名称，默认 f77   |
| RM       | 文件删除程序的名称 默认 rm -f     |
| ARFLAGS  | 库文件维护程序的选项，无默认值        |
| ASFLAGS  | 汇编程序的选项。无默认值           |
| CFLAGS   | c编译器的选项，无默认值           |
| CPPFLAGS | C预编译器的选项，无默认值          |
| CXXFLAGS | c++编译器的选项，无默认值         |
| FFLAGS   | FORTRAN编译器的选项，无默认值     |



---



#### makefile变量的使用

| 命令格式 | 含义                                  |
| ---- | ----------------------------------- |
| $*   | 不包含扩展名的目标文件名称                       |
| $+   | 所有的依赖文件，以空格分开，并以出现的先后的序，可能包含重复的依赖文件 |
| $<   | 第一个依赖文件的名称                          |
| $?   | 所有时间戳比目标文件完的依赖文件，并以空格分开             |
| $@   | 目标文件的完整名称                           |
| $^   | 所有不重复的依赖文件，以空格分开                    |
| $%   | 如果目标是归档成员，则该变量表示归档成员名称              |



---



#### 代码区



| 名称  | 作用      |
| --- | ------- |
| $^  | 不重复     |
| $@  | 目标      |
| @   | 不显示命令执行 |
| -   | 失败不停止   |



---

.phony: 当一个目标被声明为伪目标后，make在执行规则时不会去试图查找隐含规则来创建它。







---



### gcc 常用选项



1. gcc -E ： 预处理

2. gcc -S ：编译

3. gcc -c ： 汇编

4. gcc -o ： 链接







---





| 选项        | 含义                                                                                                            |
| --------- | ------------------------------------------------------------------------------------------------------------- |
| -Idir     | 在编译源程序时增加一个搜索头文件的额外目录--dir，即include增加一个搜索的额外目录                                                                |
| -Ldir     | 在编译的时候增加一个搜索库文件的额外目录--dir                                                                                     |
| -llibrary | 在编译链接文件时增加一个额外的库，库名为liblibrary.so                                                                             |
| -w        | 禁止所有警告                                                                                                        |
| -Wwarning | 允许产生warning类型的警告，warning可以是：main、unused等取值，最常用的是 -Wall，表示产生所有警告。如果warning的取值为error，其含义是将所有警告作为错误， 即出现警告就停止编译。 |


